<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessibility Scanner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 50px;
        }
        .progress-bar {
            width: 100%;
            background-color: #f3f3f3;
            margin-bottom: 20px;
        }
        .progress-bar-fill {
            height: 20px;
            background-color: #4caf50;
            width: 0;
        }
        .results {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Accessibility Scanner</h1>
    <input type="text" id="url" placeholder="Enter URL to scan">
    <button onclick="initScanner()">Scan</button>

    <div class="progress-bar">
        <div class="progress-bar-fill" id="progress-bar-fill"></div>
    </div>
    <div id="progress-text"></div>

    <div class="results" id="results"></div>

    <script>
        function initScanner() {
            const url = document.getElementById('url').value;
            if (!url) {
                alert('Please enter a URL');
                return;
            }

            const progressBarFill = document.getElementById('progress-bar-fill');
            const progressText = document.getElementById('progress-text');
            const resultsDiv = document.getElementById('results');
            
            progressBarFill.style.width = '0';
            progressText.textContent = '';
            resultsDiv.innerHTML = '';

            let progress = 0;
            const interval = setInterval(() => {
                progress = Math.min(progress + 10, 90);
                progressBarFill.style.width = `${progress}%`;
                progressText.textContent = `${progress}%`;
            }, 1000);

            fetch(`https://accessibility-scanner-backend.onrender.com/scan?url=${encodeURIComponent(url)}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    clearInterval(interval);
                    progressBarFill.style.width = '100%';
                    progressText.textContent = '100%';

                    setTimeout(() => {
                        displayResults(data, url);
                    }, 500);
                })
                .catch(error => {
                    clearInterval(interval);
                    console.error('Fetch error:', error);
                    showError('Scanning Error', `An error occurred while scanning the website: ${error.message}`);
                });
        }

        function displayResults(data, url) {
            const resultsDiv = document.getElementById('results');
            if (data.issues && data.issues.length > 0) {
                const issuesList = data.issues.map(issue => `
                    <div>
                        <p><strong>Issue:</strong> ${issue.message}</p>
                        <p><strong>Code:</strong> ${issue.code}</p>
                        <p><strong>Type:</strong> ${issue.type}</p>
                        <p><strong>Context:</strong> ${issue.context}</p>
                        <p><strong>Selector:</strong> ${issue.selector}</p>
                    </div>
                `).join('');
                resultsDiv.innerHTML = `<h2>Accessibility issues found for ${url}</h2>${issuesList}`;
            } else {
                resultsDiv.innerHTML = `<h2>No accessibility issues found for ${url}</h2>`;
            }
        }

        function showError(title, message) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `<h2>${title}</h2><p>${message}</p>`;
        }
    </script>
</body>
</html>
